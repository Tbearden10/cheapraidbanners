name = "cheapraidbanners"
compatibility_date = "2025-10-25"
main = "src/index.js"

account_id = "5e7fb995b74586d322a72a99770b31dc"

routes = [
  "cheapraidbanners.com/stats*",
  "cheapraidbanners.com/run-update*",
  "cheapraidbanners.com/admin/refresh*",
  "cheapraidbanners.com/members*"
]

[triggers]
crons = [
  "*/5 8-21 * * *",   # every 5 minutes during day -> clears run often
  "*/30 22-7 * * *"   # every 30 minutes overnight -> clears run less often
]

[[kv_namespaces]]
binding = "BUNGIE_STATS"
id = "9143657b87494c198d23b598ceed6cef"

[durable_objects]
bindings = [
  { name = "GLOBAL_STATS", class_name = "GlobalStats" }
]

# Create migration for a new SQLite-backed Durable Object class
[[migrations]]
tag = "create-globalstats-20251025-v1"
new_sqlite_classes = ["GlobalStats"]


[vars]
BUNGIE_CLAN_ID = "5335552"
BUNGIE_CLAN_ROSTER_ENDPOINT = "https://www.bungie.net/Platform/GroupV2/{clanId}/Members/"
BUNGIE_MEMBER_STATS_ENDPOINT_TEMPLATE = "https://www.bungie.net/platform/Player/{membershipType}/{membershipId}/Profile/"

BUNGIE_FETCH_CONCURRENCY = "10"
BUNGIE_PER_REQUEST_TIMEOUT_MS = "7000"

MIN_MEMBERS_UPDATE_INTERVAL_MS = "10800000" # 3 hours for members
MIN_CLEARS_UPDATE_INTERVAL_MS  = "300000"   # 5 minutes for clears

